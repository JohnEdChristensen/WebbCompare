YUI.add("stats-photo-view",(function(e){var t=500;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.statsHelper=new e.StatsHelper,this.photoId=t.photoId,this.dateString=t.dateString,this.prettyDateString=t.prettyDateString||t.dateString,this.realtimeDateString=t.realtimeDateString||t.dateString,this.isOwner=t.isOwner,this.nsid=t.nsid,this.isPro=!1,this.pickers={},this.tooltip,this.dateIntl={previousMonth:this.intlMessage({intlName:"pika-day.PREVIOUS_MONTH"}),nextMonth:this.intlMessage({intlName:"pika-day.NEXT_MONTH"})},this.dateIntl.weekdays=[this.intlMessage({intlName:"pika-day.SUNDAY"}),this.intlMessage({intlName:"pika-day.MONDAY"}),this.intlMessage({intlName:"pika-day.TUESDAY"}),this.intlMessage({intlName:"pika-day.WEDNESDAY"}),this.intlMessage({intlName:"pika-day.THURSDAY"}),this.intlMessage({intlName:"pika-day.FRIDAY"}),this.intlMessage({intlName:"pika-day.SATURDAY"})],this.dateIntl.weekdaysShort=[this.intlMessage({intlName:"pika-day.SUNDAY_SHORT"}),this.intlMessage({intlName:"pika-day.MONDAY_SHORT"}),this.intlMessage({intlName:"pika-day.TUESDAY_SHORT"}),this.intlMessage({intlName:"pika-day.WEDNESDAY_SHORT"}),this.intlMessage({intlName:"pika-day.THURSDAY_SHORT"}),this.intlMessage({intlName:"pika-day.FRIDAY_SHORT"}),this.intlMessage({intlName:"pika-day.SATURDAY_SHORT"})],this.dateIntl.months=[this.intlMessage({intlName:"pika-day.JANUARY"}),this.intlMessage({intlName:"pika-day.FEBRUARY"}),this.intlMessage({intlName:"pika-day.MARCH"}),this.intlMessage({intlName:"pika-day.APRIL"}),this.intlMessage({intlName:"pika-day.MAY"}),this.intlMessage({intlName:"pika-day.JUNE"}),this.intlMessage({intlName:"pika-day.JULY"}),this.intlMessage({intlName:"pika-day.AUGUST"}),this.intlMessage({intlName:"pika-day.SEPTEMBER"}),this.intlMessage({intlName:"pika-day.OCTOBER"}),this.intlMessage({intlName:"pika-day.NOVEMBER"}),this.intlMessage({intlName:"pika-day.DECEMBER"})],this.viewClass="",""===this.get("container").get("innerHTML")&&this.setContainerHTML('<div class="balls"></div>'),this},loadState:function(){if(!this.isOwner)return e.Promise.resolve();var t,r,a,i,n,s,o=this,l={};return this.isOwner?this.appContext.getModel("person-models",this.nsid).then((function(d){return o.isPro=d.getValue("isPro"),o.isPro?(t=e.moment().format("X"),r=new e.TimezoneHelper(o.appContext,t,"+00:00"),o.dateString||(o.dateString=r.toFormat("YYYY-MM-DD"),o.prettyDateString=r.toFormat("MMM D, YYYY"),o.realtimeDateString=o.dateString),a={date:o.dateString,photoId:o.photoId},i={id:o.statsHelper.getIdFromParams(a)},l.dailyViewsModel=o.appContext.getModel("stats-photo-daily-views-models",i,a),n={date:o.dateString,photoId:o.photoId},s={id:o.statsHelper.getIdFromParams(n)},l.referrerDomainsModel=o.appContext.getModel("stats-referrer-domains-models",s,n),l.photoModel=o.appContext.getModel("photo-models",o.photoId),l.photoStatsModel=o.appContext.getModel("photo-stats-models",o.photoId),new e.FlickrPromise(l).then((function(e){o.dailyViewsModel=e.dailyViewsModel,o.referrerDomainsModel=e.referrerDomainsModel,o.photoModel=e.photoModel,o.photoModel.stats=e.photoStatsModel}),(function(e){console.log(e)}))):e.Promise.resolve()})):e.Promise.resolve()},loadNewDateData:function(t){var r,a,i=this,n={};return a={date:t,photoId:i.photoId},r={id:this.statsHelper.getIdFromParams(a)},n.referrerDomainsModel=this.appContext.getModel("stats-referrer-domains-models",r,a),new e.FlickrPromise(n).then((function(e){t===i.dateString&&(i.referrerDomainsModel=e.referrerDomainsModel,i.refreshContent())}),(function(e){console.log(e)}))},refreshContent:function(){var e,r=t,a=this.get("container");this.updateCurrentDatePoint(this.dateString,document.querySelector("circle.selectedPoint").getAttribute("key")),this.createReferrersGraphs(),(e=a.one(".source-breakdown-right .sources-breakdown"))&&(r=e.get("clientHeight")),a.setStyles({height:Math.max(t,r+60)+"px"})},buildContainer:function(){var e=!1;return this.isPro&&this.isOwner&&(e=this.referrerDomainsModel.getValue("total")>0),this.setContainerWithTemplate("stats-photo",{hasStats:this.isPro,hasReferrers:e,prettyDateString:this.dateString===this.realtimeDateString?this.intlMessage({intlName:"stats.TODAY"}):this.prettyDateString,photoUrl:this.photoModel.getSizeToFit({width:100,height:100}).url,url:this.photoModel.getValue("url"),title:this.photoModel.getValue("title"),basicStats:this.photoModel.getValue("engagement").toJSON(),datePosted:this.photoModel.stats.getDateObj("datePosted"),actuallyHasSomeStats:this.dailyViewsModel&&this.dailyViewsModel.getValue("totals").views>0&&this.isPro}),this},activate:function(){if(!this.isOwner||!this.isPro||!this.dailyViewsModel)return this;var t=this,r=this.get("container"),a={},i=r.all(".date-picker").getDOMNodes(),n=this.dailyViewsModel.getValue("oldestDate"),s=this.dailyViewsModel.getValue("newestDate");return this.dailyViewsModel.getValue("totals").views>0&&this.isPro&&e.use("d3",(function(){r.addClass("hasStats"),t.viewClass="."+r.getAttribute("class").replace(/\s/g,"."),t.createMainGraph(),a={i18n:t.dateIntl,position:"bottom right",reposition:!1,format:"YYYY-MM-DD",minDate:e.moment(n).toDate(),maxDate:e.moment(s).toDate(),yearRange:[parseInt(n.substring(0,4),10),parseInt(s.substring(0,4),10)],defaultDate:e.moment(t.dateString).toDate(),setDefaultDate:!0,onSelect:function(e){t.pickaNewDate(e,this.config().theme)},onOpen:function(){t.el&&(t.el.className+=" stats-photo")}},e.use("pika-day",(function(e){i.forEach((function(r,i){t.pickers[i]=new e.Pikaday(e.merge(a,{field:r,theme:"picker-"+i}))}))})),t.createReferrersGraphs(),t.registerEventHandler(r.all(".photo-stats-nav-link").on("click",t.handleNavItemClick,t)),t.registerEventHandler(r.one(".source-breakdown-left").on("click",t.handleSourceBreakdownClick,t)),t.registerEventHandler(r.one(".source-breakdown-right").on("click",t.handleSourceBreakdownClick,t)),t.registerEventHandler(r.one(".source-breakdown-right").on("mouseover",t.handleSourceBreakdownListItemMouseover,t)),t.registerEventHandler(r.one(".source-breakdown-right").on("mouseout",t.handleSourceBreakdownListItemMouseout,t))})),this},handleNavItemClick:function(r){var a,i=r.target,n=i.getData("link"),s=this.get("container"),o=t;i.hasClass("selected")||(s.all(".photo-stats-nav-link").removeClass("selected"),i.addClass("selected"),s.one(".photo-stats-sections").getDOMNode().setAttribute("data-showing",n),"sources"===n?((a=s.one(".source-breakdown-right .sources-breakdown"))&&(o=a.get("clientHeight"),e.config.win.innerWidth<=700&&(o=o+140+100+70-60)),s.setStyles({height:Math.max(t,o+60)+"px"})):s.setStyles({height:"500px"}))},handleSourceBreakdownClick:function(r){var a,i,n,s,o,l,d,c,h,u,g=r.target,f=g.ancestor(),p=g.getDOMNode(),v=g.getData(),w=this.get("container"),m=w.one(".sources-pie-chart"),y=w.one(".source-breakdown-right"),k=t;if("path"===p.tagName.toLowerCase())h=this.statsHelper.whichChild(p),u="overall"===f.getDOMNode().classList[0]?y.all(".referrer-row"):y.all(".referrer-row-breakdown-row"),"other"!==f.getAttribute("referrerkey")&&"flickr embedr"!==f.getAttribute("referrerkey")&&u.getDOMNodes()[h].querySelector(".header").click();else if(g.hasClass("header")){if(v=f.getData(),(d={margin:{top:0,right:0,bottom:0,left:0}}).width=m.get("clientWidth")-d.margin.left-d.margin.right,d.height=m.get("clientHeight")-d.margin.top-d.margin.bottom,s=(n=this.referrerDomainsModel).getValue("referrers"),o=n.getValue("totals"),l=Object.keys(o),this.statsHelper.moveToFrontOfArray(l,"flickr"),w.all(".referrer-row-breakdown-row-breakdown-row.shown").replaceClass("shown","not-shown"),w.all(".referrer-row-breakdown-row-breakdown .show-whole-list").removeClass("no-show"),v.category){if(c=y.getData("showing"),a=v.category,y.all(".referrer-row").removeClass("selected"),e.AttributeHelpers.coerceBoolean(v.isempty))return"NOPE"!==c&&this.createOverallPieChart(d,l,o,null,null,!1),e.d3.selectAll(this.viewClass+" .sources-pie-chart .first-level").remove(),e.d3.selectAll(this.viewClass+" .sources-pie-chart .second-level").remove(),y.all(".referrer-row-breakdown-row").removeClass("selected"),y.setData("showing","NOPE"),void y.setData("subshowing","NOPE");c!==a?(f.addClass("selected"),y.setData("showing",a),w.one(".first-level")&&(e.d3.selectAll(this.viewClass+" .sources-pie-chart .first-level").remove(),e.d3.selectAll(this.viewClass+" .sources-pie-chart .second-level").remove(),y.all(".referrer-row-breakdown-row").removeClass("selected"),y.setData("subshowing","NOPE")),this.createOverallPieChart(d,l,o,!0),"other"===a||"flickr embedr"===a?this.createPieChart("first-level",d,Object.keys(s[a].items),s[a].items,a):this.createPieChart("first-level",d,Object.keys(s[a]),s[a],a)):(y.setData("showing","NOPE"),this.createOverallPieChart(d,l,o,null,null,!1),"other"===a||"flickr embedr"===a?this.createPieChart("first-level",d,Object.keys(s[a].items),s[a].items,a,null,!0):this.createPieChart("first-level",d,Object.keys(s[a]),s[a],a,null,!0),e.d3.selectAll(this.viewClass+" .sources-pie-chart .second-level").remove(),y.setData("subshowing","NOPE"))}else if(v.referrer){if(c=y.getData("subshowing"),a=v.referrer,i=v.parentcategory,y.all(".referrer-row-breakdown-row").removeClass("selected"),e.AttributeHelpers.coerceBoolean(v.isempty))return y.setData("subshowing","NOPE"),void("NOPE"!==c&&(this.createPieChart("first-level",d,Object.keys(s[i]),s[i],i,null,"fakeOpen"),this.createPieChart("second-level",d,Object.keys(s[i][c].items),s[i][c].items,c,i,!0)));c!==a?(f.addClass("selected"),y.setData("subshowing",a),w.one(".first-level")&&e.d3.selectAll(this.viewClass+" .sources-pie-chart .second-level").remove(),this.createPieChart("first-level",d,Object.keys(s[i]),s[i],i,null,"fakeClose"),this.createPieChart("second-level",d,Object.keys(s[i][a].items),s[i][a].items,a,i)):(y.setData("subshowing","NOPE"),this.createPieChart("first-level",d,Object.keys(s[i]),s[i],i,null,"fakeOpen"),this.createPieChart("second-level",d,Object.keys(s[i][a].items),s[i][a].items,a,i,!0))}k=w.one(".source-breakdown-right .sources-breakdown").get("clientHeight"),e.config.win.innerWidth<=700&&(k=k+140+100+70-60),w.setStyles({height:Math.max(t,k+60)+"px"})}else g.hasClass("show-whole-list")&&(w.all(".referrer-row-breakdown-row-breakdown-row.not-shown").replaceClass("not-shown","shown"),w.all(".referrer-row-breakdown-row-breakdown .show-whole-list").addClass("no-show"))},handleSourceBreakdownListItemMouseover:function(e){var t,r,a=e.target,i=a.ancestor(),n=this.get("container");i.hasClass("referrer-row")?(t=this.statsHelper.whichChild(i.getDOMNode()),(r=n.one(".source-breakdown-left").all(".pie-chart .overall path")).setAttribute("class","not-selected"),r.getDOMNodes()[t].setAttribute("class","")):i.hasClass("referrer-row-breakdown-row")?(t=this.statsHelper.whichChild(i.getDOMNode()),(r=n.one(".source-breakdown-left").all(".pie-chart .first-level path")).setAttribute("class","not-selected"),r.getDOMNodes()[t].setAttribute("class","")):a.hasClass("referrer-row-breakdown-row-breakdown-row")&&(t=this.statsHelper.whichChild(a.getDOMNode()),(r=n.one(".source-breakdown-left").all(".pie-chart .second-level path")).setAttribute("class","not-selected"),r.getDOMNodes()[t].setAttribute("class",""))},handleSourceBreakdownListItemMouseout:function(e){var t=e.target;"pie"!==t.getDOMNode().getAttribute("class")&&"path"!==t.getDOMNode().tagName&&this.get("container").all(".source-breakdown-left .pie-chart path").setAttribute("class","")},pickaNewDate:function(t,r){var a,i,n=new e.TimezoneHelper(this.appContext,t.getTime()/1e3+Math.abs(60*t.getTimezoneOffset()),"+00:00");for(a in this.dateString=n.toFormat("YYYY-MM-DD"),this.prettyDateString=n.toFormat("MMM D, YYYY"),this.pickers)i=this.dateString===this.realtimeDateString?this.intlMessage({intlName:"stats.TODAY"}):this.prettyDateString,i+=" <span></span>",this.pickers[a]._o.field.innerHTML=i,a!==r&&this.pickers[a].setMoment(n.momentObject,!0);this.loadNewDateData(this.dateString)},createMainGraph:function(){var t,r,a,i,n,s,o=this.dailyViewsModel,l=o.getValue("days"),d=Object.keys(l),c=o.getValue("newestDate"),h=e.d3.time.format("%Y-%m-%d").parse,u=this,g=this.get("container"),f=".daily-views-graph",p=g.one(f),v=[],w="linear";this.daysKeys=d,(r={margin:{top:15,right:15,bottom:90,left:60}}).width=p.get("clientWidth")-r.margin.left-r.margin.right,r.height=p.get("clientHeight")-r.margin.top-r.margin.bottom,u.createYStuff=function(t){var a={yMin:0};return a.yMax=e.d3.max(d,(function(e,r){return+l[e][t]})),a.yMax=Math.ceil(1.2*a.yMax),a.yMaxLength=a.yMax.toString().length,a.yAxisDivisor=Math.pow(10,Math.max(0,a.yMaxLength-2)),a.yMax=Math.ceil(.2*a.yMax/a.yAxisDivisor)*a.yAxisDivisor*5,a.yAxisValues=[0,Math.ceil(.2*a.yMax/a.yAxisDivisor)*a.yAxisDivisor,Math.ceil(.4*a.yMax/a.yAxisDivisor)*a.yAxisDivisor,Math.ceil(.6*a.yMax/a.yAxisDivisor)*a.yAxisDivisor,Math.ceil(.8*a.yMax/a.yAxisDivisor)*a.yAxisDivisor,Math.ceil(a.yMax/a.yAxisDivisor)*a.yAxisDivisor],a.y=e.d3.scale.linear().range([r.height,0]).domain([a.yMin,a.yMax]),a.yAxis=e.d3.svg.axis().scale(a.y).orient("left").tickSubdivide(!1).tickValues(a.yAxisValues).tickFormat((function(e,t){var r=e;return 0===t&&(r=""),r})),a},s={views:u.createYStuff("views"),favs:u.createYStuff("favs"),comments:u.createYStuff("comments")},d.forEach((function(e,t){v.push(h(e))})),i=e.d3.extent(d,(function(e,t){return h(e)})),a=e.d3.time.scale().range([0,r.width]).domain(i),n=e.d3.svg.axis().scale(a).orient("bottom").tickValues(v).tickFormat((function(t,r){var a="";return r%2==0&&(a=parseInt(e.d3.time.format("%e")(t),10),0!==r&&1!==a&&2!==a||(a+=" "+e.d3.time.format("%b")(t))),a})),(t=e.d3.select(u.viewClass+" "+f).append("svg").attr("class","main-graph").attr("width",r.width+r.margin.left+r.margin.right).attr("height",r.height+r.margin.top+r.margin.bottom).on("mouseleave",(function(){e.d3.select(u.viewClass+" .selectedPoint").attr("cx",-100).attr("cy",-100)}))).append("defs").append("linearGradient").attr("id","photoDailyViewsViews").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").selectAll("stop").data([{offset:"0%",color:"#24d9d7"},{offset:"100%",color:"#00aaff"}]).enter().append("stop").attr("offset",(function(e){return e.offset})).attr("stop-color",(function(e){return e.color})),t.append("g").attr("class","weekends").attr("transform","translate("+r.margin.left+", "+r.margin.top+")").attr("width",r.width).attr("height",r.height).selectAll("rect").data(d).enter().append("rect").attr("class",(function(e,t){var r=h(e).getDay(),a="";return 0!==r&&6!==r||(a="weekend"),a})).attr("y",0).attr("x",(function(e,t){var i=a(h(e));return t>0&&(i-=r.width/d.length/2),i})).attr("height",r.height).attr("width",(function(e,t){var a=r.width/d.length;return 0!==t&&t!==d.length-1||(a/=2),a})),t.append("g").attr("class","gridlines").attr("transform","translate(0, "+r.margin.top+")").selectAll("line").data(s.views.yAxisValues).enter().append("line").attr("x1",0).attr("x2",r.width+r.margin.left+r.margin.right).attr("y1",(function(e){return s.views.y(e)})).attr("y2",(function(e){return s.views.y(e)})),u.createYAxis=function(t,a){var i=!1;(i=e.d3.selectAll(u.viewClass+" .y.axis"))&&i.remove(),t.insert("g",".x.axis").attr("class","y axis").attr("transform","translate("+r.margin.left+", "+r.margin.top+")").call(s[a].yAxis).selectAll("text").attr("x","-10").attr("y","12")},u.createYAxis(t,"views"),t.append("g").attr("class","x axis").attr("transform","translate("+r.margin.left+", "+(r.height+r.margin.top)+")").call(n).selectAll("text").attr("y","10").call((function(t){t.each((function(){for(var t,r=e.d3.select(this),a=r.text().split(/\s+/).reverse(),i=[],n=0,s=r.attr("y"),o=parseFloat(r.attr("dy")),l=r.text(null).append("tspan").attr("x",0).attr("y",s).attr("dy",o+"em"),d=a.length;t=a.pop();)i.push(t),l.text(i.join(" ")),d>1&&(i.pop(),l.text(i.join(" ")),i=[t],""!==t&&" "!==t&&(l=r.append("tspan").attr("x",0).attr("y",s).attr("dy",1.1*n+++o+"em").text(t)))}))})),u.createFlatLine=function(){return e.d3.svg.line().x((function(e){return a(h(e))})).y((function(e){return s.views.y(0)}))},u.createLine=function(t){return e.d3.svg.line().interpolate(w).x((function(e){return a(h(e))})).y((function(e){return s[t].y(l[e][t])}))},u.createArea=function(t){return e.d3.svg.area().interpolate(w).x((function(e){return a(h(e))})).y0(r.height).y1((function(e){return s[t].y(l[e][t])}))},t.append("path").attr("class","main-line views").attr("transform","translate("+r.margin.left+", "+r.margin.top+")").attr("d",u.createFlatLine()(d)).attr("stroke","url(#photoDailyViewsViews)").transition().delay(500).duration(500).attr("d",u.createLine("views")(d)),u.updatePoint=function(t,i,n,o){var d=e.d3.select(u.viewClass+" "+t),c=d.attr("cx"),g=d.attr("cy"),f=a(h(i))+r.margin.left,p=s[n].y(l[i][n])+r.margin.top;return o?d.transition().duration(500).attr("cx",f).attr("cy",p).attr("date",i).attr("key",n):d.attr("cx",f).attr("cy",p).attr("date",i).attr("key",n),{point:d,oldXY:[c,g],newXY:[f,p]}},u.updateCurrentDatePoint=function(e,t,r){u.updatePoint(".currentDatePoint",e,t,r)},u.updateSelectedPoint=function(t,r,a){u.updatePoint(".selectedPoint",t,r,a);var i,n,s={};return i={date:t,photoId:u.photoId},n={id:u.statsHelper.getIdFromParams(i)},s.referrerDomainsModel=this.appContext.getModel("stats-referrer-domains-models",n,i),new e.FlickrPromise(s).then((function(e){}),(function(e){console.log(e)}))},u.createVoronoi=function(i){var n=!1;(n=e.d3.selectAll(u.viewClass+" g.voronoi"))&&n.remove(),t.insert("g",".selectedPoint").attr("class","voronoi").attr("transform","translate("+r.margin.left+", "+r.margin.top+")").attr("width",r.width+r.width/d.length).attr("height",r.height).selectAll("rect").data(d).enter().append("rect").attr("y",0).attr("x",(function(e,t){var i=a(h(e));return i-=r.width/d.length/2})).attr("height",r.height).attr("width",(function(e,t){return r.width/d.length})).on("mouseenter",(function(e,t){u.updateSelectedPoint(d[t],i)}))},t.append("circle").attr("class","currentDatePoint").attr("date",c).attr("key","views").attr("r",7).attr("cx",(function(e,t){return c===u.dateString?a(h(c))+r.margin.left:a(h(u.dateString))+r.margin.left})).attr("cy",s.views.y(0)+r.margin.top).transition().delay(500).duration(500).attr("cy",(function(e,t){return c===u.dateString?s.views.y(l[c].views)+r.margin.top:s.views.y(l[u.dateString].views)+r.margin.top})),t.append("circle").attr("class","selectedPoint").attr("cx",-100).attr("cy",-100).attr("r",4).attr("date",c).attr("key","views").on("click",(function(){u.pickaNewDate(new Date(this.getAttribute("date")))})).on("mouseenter",(function(t,r){var a,i=this.getAttribute("date"),n=l[i],s=new Date(i),o=new e.TimezoneHelper(u.appContext,s.getTime()/1e3+Math.abs(60*s.getTimezoneOffset()),"+00:00").toFormat("MMMM D"),d=150,c=n.views;n.favs>c&&(c=n.favs),n.comments>c&&(c=n.comments),d+=20*(c.toString().length-1),a='<div class="date">'+o+'</div><div class="stats"><div class="stat"><i class="icon" data-type="views"></i>'+u.intlMessage({intlName:"stats.NUMBER",num:n.views})+'</div><div class="stat"><i class="icon" data-type="faves"></i>'+u.intlMessage({intlName:"stats.NUMBER",num:n.favs})+'</div><div class="stat"><i class="icon" data-type="comments"></i>'+u.intlMessage({intlName:"stats.NUMBER",num:n.comments})+"</div></div>",u.tooltip?u.tooltip.updateHTMLMessage(a):(u.tooltip=new e.Views.FluidDroparound({appContext:u.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,showDropArrow:!0,preferTop:!0,preferLeft:!0,width:d,height:60,classList:"photo-daily-stats-tooltip over-modal",anchorElement:g.one(".selectedPoint"),hideModalOverlay:!0,invisibleOverlay:!0,htmlMessage:a,anchorOffsetVertical:10,closeOnScroll:!0}),u.tooltip.show())})).on("mouseleave",(function(e){u.tooltip&&(u.tooltip.close(),u.tooltip=void 0)})),u.createVoronoi("views")},createReferrersGraphs:function(){var e,t,r,a=this,i=this.referrerDomainsModel,n=i.getValue("referrers"),s=i.getValue("total"),o=i.getValue("totals"),l=this.get("container"),d=l.one(".sources-pie-chart"),c=l.one(".source-breakdown-left"),h=l.one(".source-breakdown-right"),u=d.one(".overall"),g="";h.setData("showing","NOPE"),h.setData("subshowing","NOPE"),0===parseInt(s,10)?(c.addClass("no-results"),h.addClass("no-results")):(c.removeClass("no-results"),h.removeClass("no-results"),e=Object.keys(n),this.statsHelper.moveToFrontOfArray(e,"flickr"),this.statsHelper.moveToEndOfArray(e,"other"),t=Object.keys(o),this.statsHelper.moveToFrontOfArray(t,"flickr"),this.statsHelper.moveToEndOfArray(t,"other"),(r={margin:{top:0,right:0,bottom:0,left:0}}).width=d.get("clientWidth")-r.margin.left-r.margin.right,r.height=d.get("clientHeight")-r.margin.top-r.margin.bottom,this.set("outerRadius",r.height/2),u?a.createOverallPieChart(r,t,o,!1,!0):a.createOverallPieChart(r,t,o),g='<div class="referrer-rows">',t.forEach((function(e,t){"search"===e&&0===o[e]?g+='<div class="referrer-row" data-category="'+e+'" data-isempty="true">':g+='<div class="referrer-row" data-category="'+e+'" data-isempty="false">',g+='<div class="header">',"search"===e&&0===o[e]?g+='<div><span class="dot"></span>'+e+"</div>":g+='<div><span class="dot"></span>'+e+'<span class="caret"></span></div>',g+="<div>"+a.intlMessage({intlName:"stats.NUMBER",num:o[e]})+"</div>",g+="<div>"+Math.round(o[e]/s*100)+"%</div>",g+="</div>",g+="</div>"})),g+="</div>",h.one(".sources-breakdown-list").empty().append(g),e.forEach((function(e,t){var r,i,s,l="";"other"===e||"flickr embedr"===e?(r=n[e].items,i=Object.keys(r),void 0!==(s=o[e]).viewcount&&(s=s.viewcount),l='<div class="referrer-row-breakdown" data-index="'+t+'" data-group="'+e+'">'+a.createOtherReferrerListRowsHTML(i,r,s,e)+"</div>"):(r=n[e],i=Object.keys(r),s=o[e],l='<div class="referrer-row-breakdown" data-index="'+t+'" data-group="'+e+'">'+a.createReferrerListRowsHTML(i,r,s,e)+"</div>"),h.one('.referrer-row[data-category="'+e+'"]').append(l)})))},createOverallPieChart:function(t,r,a,i,n){i||(i=!1);var s,o,l,d,c=this.get("outerRadius"),h=this.get("innerRadius"),u=501,g=".sources-pie-chart",f=this.get("container").one(g).one("svg .overall"),p=0;r.forEach((function(e){var t=a[e];void 0!==t.viewcount&&(t=t.viewcount),p+=t})),e.d3.scale.linear().domain([1,r.length]).range(["#00aaff","#18297f"]),o=e.d3.svg.arc().innerRadius(h).outerRadius(c),n&&f&&(e.d3.select(this.viewClass+" "+g+" svg").remove(),f=!1),f?i?(l=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(-2*Math.PI).value((function(e,t){var r=a[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),d=(s=e.d3.select(this.viewClass+" "+g+" svg .overall")).datum(r).selectAll("path").call((function(t){t.transition().delay((function(e,t){var i=0,n=0,s=0;if(t>0){for(s=t-1;s>=0;--s)void 0!==a[r[s]].viewcount?n+=a[r[s]].viewcount:n+=a[r[s]];i=n/p*u}return i})).duration((function(e,t){return e.value/p*u})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.startAngle=r(e),o(t)}}))}))):(l=e.d3.layout.pie().startAngle(2*Math.PI).endAngle(0*Math.PI).value((function(e,t){var r=a[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),(d=(s=e.d3.select(this.viewClass+" "+g+" svg .overall")).selectAll("path")).data().map((function(e,t){e.startAngle=e.originalStartAngle,e.endAngle=e.originalEndAngle})),d.call((function(t){t.transition().delay((function(e,t){var i=0,n=0;for(n=t+1;n<r.length;n++)void 0!==a[r[n]].viewcount?i+=a[r[n]].viewcount:i+=a[r[n]];return i/p*u})).duration((function(e,t){return e.value/p*u})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.startAngle=r(e),o(t)}}))})),e.d3.select(this.viewClass+" "+g+" svg text").text(p)):(l=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e,t){var r=a[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),d=(s=e.d3.select(this.viewClass+" "+g).append("svg").attr("class","pie").attr("width",t.width+t.margin.left+t.margin.right).attr("height",t.height+t.margin.top+t.margin.bottom).append("g").attr("class","overall").attr("height",t.height+t.margin.top+t.margin.bottom).attr("width",2*c).attr("transform","translate("+t.width/2+", "+c+")")).datum(r).selectAll("path").data(l).enter().append("path").attr("data-source",(function(e){return e.data})).on("mouseenter",function(e,t){var r,a,i=this.get("container");r=i.all(".source-breakdown-right .referrer-row"),a=i.all(".source-breakdown-left .pie-chart .overall path"),r.removeClass("temp-selected"),r.getDOMNodes()[t].setAttribute("class",r.getDOMNodes()[t].getAttribute("class")+" temp-selected"),a.setAttribute("class","not-selected"),a.getDOMNodes()[t].setAttribute("class","")}.bind(this)).on("mouseleave",function(e,t){var r,a,i=this.get("container");r=i.all(".source-breakdown-right .referrer-row"),a=i.all(".source-breakdown-left .pie-chart .overall path"),r.removeClass("temp-selected"),a.setAttribute("class","")}.bind(this)).transition().delay((function(e,t){var i=0,n=0,s=0;if(t>0){for(s=t-1;s>=0;--s)void 0!==a[r[s]].viewcount?n+=a[r[s]].viewcount:n+=a[r[s]];i=n/p*u}return i})).duration((function(e,t){return e.value/p*u})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.endAngle=r(e),o(t)}})).each("end",(function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle})),s.append("text").attr("transform","translate(0, 5)").attr("fill-opacity",0).text(p).transition().delay(250.5).duration(250.5).attr("fill-opacity",1))},createPieChart:function(t,r,a,i,n,s,o){o||(o=!1);var l,d,c,h,u,g=this.get("outerRadius"),f=this.get("innerRadius"),p=501,v=".sources-pie-chart",w=this.get("container").one(v).one("svg ."+t),m=0,y=a.length;return a.forEach((function(e){var t=i[e];void 0!==t.viewcount&&(t=t.viewcount),m+=t})),u=e.d3.scale.linear().domain([1,a.length]).range(["#00aaff","#18297f"]),d=e.d3.svg.arc().innerRadius(f).outerRadius(g),w?!0===o?0===m?(c=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e,t){return 1})).sort(null),h=(l=e.d3.select(this.viewClass+" "+v+" svg ."+t)).datum(a).selectAll("path").call((function(t){t.transition().delay((function(e,t){var r=0,i=0;for(i=t+1;i<a.length;i++)r+=1;return r/y*p})).duration((function(e,t){return e.value/y*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.endAngle=r(e),d(t)}})).each("end",(function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle}))}))):(c=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e,t){var r=i[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),h=(l=e.d3.select(this.viewClass+" "+v+" svg ."+t)).datum(a).selectAll("path").call((function(t){t.transition().delay((function(e,t){var r=0,n=0;for(n=t+1;n<a.length;n++)void 0!==i[a[n]].viewcount?r+=i[a[n]].viewcount:r+=i[a[n]];return r/m*p})).duration((function(e,t){return e.value/m*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.endAngle=r(e),d(t)}})).each("end",(function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle}))}))):"fakeClose"===o?(c=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(-2*Math.PI).value((function(e,t){var r=i[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),h=(l=e.d3.select(this.viewClass+" "+v+" svg ."+t)).datum(a).selectAll("path").call((function(t){t.transition().delay((function(e,t){var r=0,n=0,s=0;if(t>0){for(s=t-1;s>=0;--s)void 0!==i[a[s]].viewcount?n+=i[a[s]].viewcount:n+=i[a[s]];r=n/m*p}return r})).duration((function(e,t){return e.value/m*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.startAngle=r(e),d(t)}}))}))):(c=e.d3.layout.pie().startAngle(2*Math.PI).endAngle(0*Math.PI).value((function(e,t){var r=i[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),(h=(l=e.d3.select(this.viewClass+" "+v+" svg ."+t)).selectAll("path")).data().map((function(e,t){e.startAngle=e.originalStartAngle,e.endAngle=e.originalEndAngle})),h.call((function(t){t.transition().delay((function(e,t){var r=0,n=0;for(n=t+1;n<a.length;n++)void 0!==i[a[n]].viewcount?r+=i[a[n]].viewcount:r+=i[a[n]];return r/m*p})).duration((function(e,t){return e.value/m*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.startAngle=r(e),d(t)}}))})),e.d3.select(this.viewClass+" "+v+" svg text").text(m)):(0===m?(c=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e,t){return 1})).sort(null),h=(l=e.d3.select(this.viewClass+" "+v+" svg").append("g").attr("class",t).attr("referrerkey",n).attr("parentreferrerkey",s).attr("height",r.height+r.margin.top+r.margin.bottom).attr("width",2*g).attr("transform","translate("+r.width/2+", "+g+")")).datum(a).selectAll("path").data(c).enter().append("path").attr("data-source",(function(e){var t=e.data;return"flickr"!==n&&"other"!==n&&"flickr embedr"!==n||(t=""),t})).attr("fill",(function(e,t){var r="";return("flickr"===n||"other"===n||"flickr embedr"===n||s)&&(r=u(t)),r})).transition().delay((function(e,t){var r=0,a=0,i=0;if(t>0){for(i=t-1;i>=0;--i)a+=1;r=a/y*p}return r})).duration((function(e,t){return e.value/y*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.endAngle=r(e),d(t)}})).each("end",(function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle}))):(c=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e,t){var r=i[e];return void 0!==r.viewcount&&(r=r.viewcount),r})).sort(null),
h=(l=e.d3.select(this.viewClass+" "+v+" svg").append("g").attr("class",t).attr("referrerkey",n).attr("parentreferrerkey",s).attr("height",r.height+r.margin.top+r.margin.bottom).attr("width",2*g).attr("transform","translate("+r.width/2+", "+g+")")).datum(a).selectAll("path").data(c).enter().append("path").attr("data-source",(function(e){var t=e.data;return"flickr"!==n&&"other"!==n&&"flickr embedr"!==n||(t=""),t})).attr("fill",(function(e,t){var r="";return("flickr"===n||"other"===n||"flickr embedr"===n||s)&&(r=u(t)),r})).on("mouseenter",function(e,r){var a,i,o,l=this.get("container");s?(a=l.all('.source-breakdown-right .referrer-row .referrer-row-breakdown-row[data-parentcategory="'+s+'"][data-referrer="'+n+'"] .referrer-row-breakdown-row-breakdown-row:not(.not-shown)'),i=l.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+n+'"] path'),a.removeClass("selected"),(o=a.getDOMNodes()[r])&&o.setAttribute("class","referrer-row-breakdown-row-breakdown-row temp-selected")):(a=l.all('.source-breakdown-right .referrer-row .referrer-row-breakdown[data-group="'+n+'"] .referrer-row-breakdown-row'),i=l.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+n+'"] path'),a.removeClass("selected"),a.getDOMNodes()[r].setAttribute("class","referrer-row-breakdown-row temp-selected")),i.setAttribute("class","not-selected"),i.getDOMNodes()[r].setAttribute("class","")}.bind(this)).on("mouseleave",function(e,r){var a,i,o=this.get("container");s?(a=o.all('.source-breakdown-right .referrer-row .referrer-row-breakdown-row[data-parentcategory="'+s+'"][data-referrer="'+n+'"] .referrer-row-breakdown-row-breakdown-row'),i=o.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+n+'"] path')):(a=o.all('.source-breakdown-right .referrer-row .referrer-row-breakdown[data-group="'+n+'"] .referrer-row-breakdown-row'),i=o.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+n+'"] path')),a.removeClass("temp-selected"),i.setAttribute("class","")}.bind(this)).transition().delay((function(e,t){var r=0,n=0,s=0;if(t>0){for(s=t-1;s>=0;--s)void 0!==i[a[s]].viewcount?n+=i[a[s]].viewcount:n+=i[a[s]];r=n/m*p}return r})).duration((function(e,t){return e.value/m*p})).ease("linear").attrTween("d",(function(t){var r=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.endAngle=r(e),d(t)}})).each("end",(function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle}))),e.d3.select(this.viewClass+" "+v+" svg text").text(m)),l},createReferrerBreakdownListRowsHTML:function(t,r,a,i){var n,s,o=this,l="";return n=Object.keys(t),s=e.d3.scale.linear().domain([1,n.length]).range(["#00aaff","#18297f"]),l='<div class="referrer-row-breakdown-row-breakdown">',n.forEach((function(a,i){var n,d,c,h,u=!1,g=t[a].viewcount;n="referrer-row-breakdown-row-breakdown-row",i>=5&&(n+=" not-shown"),"direct"!==(d=e.Escape.html(t[a].displaytext)).toLowerCase()&&"/"!==d||(t[a].platform&&(d=t[a].platform.split(".")[1]),t[a].link&&""!==t[a].link&&"/"!==t[a].link&&(d=t[a].link)),t[a].link&&""!==t[a].link&&"/"!==t[a].link&&(u=!0,c=e.Escape.html(t[a].link)),h=' style="background: '+s(i)+';"',l+=u?'<a class="'+n+'" title="'+d+'" href="'+c+'" target="_blank">':'<div class="'+n+'" title="'+d+'">',l+='<div><span class="dot"'+h+"></span>"+d+"</div>",l+="<div>"+o.intlMessage({intlName:"stats.NUMBER",num:g})+"</div>",l+="<div>"+Math.round(g/r*100)+"%</div>",l+=u?"</a>":"</div>"})),n.length>5&&(l+='<div class="show-whole-list">'+o.intlMessage({intlName:"stats.SHOW_ALL"})+"</div>"),l+="</div>"},createReferrerListRowsHTML:function(t,r,a,i){var n,s="",o=this,l="";return n=e.d3.scale.linear().domain([1,t.length]).range(["#00aaff","#18297f"]),t.forEach((function(e,t){var d=r[e],c=e;"sets"===c.toLowerCase()&&(c="Albums"),void 0!==d.viewcount&&(d=d.viewcount),"flickr"!==i&&"other"!==i&&"flickr embedr"!==i||(l=' style="background: '+n(t)+';"'),s+='<div class="referrer-row-breakdown-row" title="'+c+'" data-parentcategory="'+i+'" data-referrer="'+e+'" data-isempty="'+!r[e].items+'">',s+='<div class="header">',r[e].items?s+='<div><span class="dot"'+l+"></span>"+c+'<span class="caret"></span></div>':s+='<div><span class="dot"'+l+"></span>"+c+"</div>",s+="<div>"+o.intlMessage({intlName:"stats.NUMBER",num:d})+"</div>",s+=a>0?"<div>"+Math.round(d/a*100)+"%</div>":"<div>0%</div>",s+="</div>",r[e].items&&(s+=o.createReferrerBreakdownListRowsHTML(r[e].items,d,i,e)),s+="</div>"})),s},createOtherReferrerListRowsHTML:function(t,r,a,i){var n,s=this,o="";return n=e.d3.scale.linear().domain([1,t.length]).range(["#00aaff","#18297f"]),t.forEach((function(t,l){var d,c,h,u=!1,g=r[t].viewcount;"direct"!==(d=e.Escape.html(r[t].displaytext)).toLowerCase()&&"/"!==d||(r[t].platform&&(d=r[t].platform.split(".")[1]),r[t].link&&""!==r[t].link&&"/"!==r[t].link&&(d=r[t].link)),r[t].link&&""!==r[t].link&&"/"!==r[t].link&&(u=!0,c=e.Escape.html(r[t].link)),h=' style="background: '+n(l)+';"',o+=u?'<a class="referrer-row-breakdown-row" title="'+d+'" href="'+c+'" target="_blank" data-parentcategory="'+i+'">':'<div class="referrer-row-breakdown-row" title="'+d+'" data-parentcategory="'+i+'">',o+='<div class="header">',o+='<div><span class="dot"'+h+"></span>"+d+'<span class="caret"></span></div>',o+="<div>"+s.intlMessage({intlName:"stats.NUMBER",num:g})+"</div>",o+="<div>"+Math.round(g/a*100)+"%</div>",o+="</div>",o+=u?"</a>":"</div>"})),o},destructor:function(){this.tooltip&&(this.showTooltip=!1,this.tooltip.close(),this.tooltip=void 0)}},{ATTRS:{innerRadius:{value:29},outerRadius:{value:0}}})}),"@VERSION@",{requires:["flickr-view","hermes-template-stats-photo","moment","timezone-helper","stats-helper","photo-models","photo-engagement-models","photo-stats-models","stats-photo-daily-views-models","stats-referrer-domains-models"],optional:[],langBundles:["common","stats","pika-day","photo-page-scrappy"]});YUI.add("hermes-lang-pika-day",(function(e,a){e.Intl.add("hermes/pika-day","en-US",{DATE_FORMAT:[{type:0,value:"MM-DD-YYYY"}],PREVIOUS_MONTH:[{type:0,value:"Previous Month"}],NEXT_MONTH:[{type:0,value:"Next Month"}],JANUARY:[{type:0,value:"January"}],FEBRUARY:[{type:0,value:"February"}],MARCH:[{type:0,value:"March"}],APRIL:[{type:0,value:"April"}],MAY:[{type:0,value:"May"}],JUNE:[{type:0,value:"June"}],JULY:[{type:0,value:"July"}],AUGUST:[{type:0,value:"August"}],SEPTEMBER:[{type:0,value:"September"}],OCTOBER:[{type:0,value:"October"}],NOVEMBER:[{type:0,value:"November"}],DECEMBER:[{type:0,value:"December"}],SUNDAY:[{type:0,value:"Sunday"}],MONDAY:[{type:0,value:"Monday"}],TUESDAY:[{type:0,value:"Tuesday"}],WEDNESDAY:[{type:0,value:"Wednesday"}],THURSDAY:[{type:0,value:"Thursday"}],FRIDAY:[{type:0,value:"Friday"}],SATURDAY:[{type:0,value:"Saturday"}],SUNDAY_SHORT:[{type:0,value:"S"}],MONDAY_SHORT:[{type:0,value:"M"}],TUESDAY_SHORT:[{type:0,value:"T"}],WEDNESDAY_SHORT:[{type:0,value:"W"}],THURSDAY_SHORT:[{type:0,value:"T"}],FRIDAY_SHORT:[{type:0,value:"F"}],SATURDAY_SHORT:[{type:0,value:"S"}]})}),"@VERSION@",{requires:["intl"]});YUI.add("sub-photo-right-stats-view",(function(t,e){var o=require("hermes-core/flog")(e);t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.isOwner=e.isOwner,this.nsid=e.nsid,this.statsHelper=new t.StatsHelper,""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("sub-photo-right-stats",{stats:{},loadingView:!0}),this},loadState:function(){var e=this,s={};return s.photoEngagement=this.appContext.getModel("photo-engagement-models",this.photoId),this.isOwner&&(s.personModel=this.appContext.getModel("person-models",this.nsid)),new t.FlickrPromise(s).then((function(i){var n,a,r,l;if(e.set("photo-engagement",i.photoEngagement),i.personModel)return e.isPro=i.personModel.getValue("isPro"),e.isPro?(n=t.moment().format("X"),a=new t.TimezoneHelper(e.appContext,n,"+00:00"),e.dateString||(e.dateString=a.toFormat("YYYY-MM-DD"),e.prettyDateString=a.toFormat("MMM D, YYYY"),e.realtimeDateString=e.dateString),r={date:e.dateString,photoId:e.photoId},l={id:e.statsHelper.getIdFromParams(r)},s.dailyViewsModel=e.appContext.getModel("stats-photo-daily-views-models",l,r),new t.FlickrPromise(s).then((function(t){e.dailyViewsModel=t.dailyViewsModel}),(function(t){o.error("Error loadState",{err:t})}))):t.Promise.resolve()}),(function(t){o.error("Error loadState",{err:t})}))},buildContainer:function(){var t,e,o=this.get("photo-engagement"),s=!1;return o.getValue("viewCount")>=1e6||o.getValue("faveCount")>=1e5||o.getValue("commentCount")>=1e5?e=!0:(o.getValue("viewCount")>=1e5||o.getValue("faveCount")>=1e4||o.getValue("commentCount")>=1e4)&&(t=!0),(this.isOwner&&this.isPro&&this.dailyViewsModel&&this.dailyViewsModel.getValue("totals").views>0||this.isOwner&&!this.isPro&&this.appContext.flipper.isFlipped("enable-upsell-show-more-stats"))&&(s=!0),this.setContainerWithTemplate("sub-photo-right-stats",{engagement:o.toJSON(),smallText:t,superSmallText:e,showMoreStatsLink:s}),this},activate:function(){var t=this,e=t.get("container").one(".show-more-stats");return this.get("photo-engagement")&&this.registerEventHandler(this.get("photo-engagement").on("valuesChanged",(function(e){(e.commentCount||e.faveCount||e.reactions)&&t.buildContainer()}))),e&&this.registerEventHandler(this.get("container").one(".show-more-stats").on("click",this.handleShowMoreStatsClick,this)),this},handleShowMoreStatsClick:function(e){e.halt();var o,s=this,i=this.photoId;if(this.isPro)o=new t.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!1,showBodyLines:!0,showCancelButton:!1,showFooter:!1,showCancelX:!0,title:s.intlMessage({intlName:"stats.PHOTO_STATS"}),subview:new t.Views["stats-photo-view"]({appContext:s.appContext,photoId:i,isOwner:s.isOwner,nsid:s.appContext.getViewer().nsid}),width:Math.round(.7*Math.max(1280,t.config.win.innerWidth)),height:540,fullWindow:!1,classList:"stats-photo-modal",hideModalOverlay:!1});else{var n=this.templates("stats-pro-upsell-modal")({lang:s.appContext.lang.toLowerCase()});(o=new t.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!1,showBodyLines:!1,showCancelButton:!1,showFooter:!1,showCancelX:!0,htmlMessage:n,height:540,fullWindow:!1,classList:"stats-pro-upsell-modal",hideModalOverlay:!1})).on("activated",(function(){var t=o.get("container").one(".get-pro-button");t&&t.on("click",(function(t){s.appContext.flapp.navigate("/account/upgrade/pro?utm_campaign=web&utm_source=desktop&utm_medium=stats_upsell&utm_content=upgrade")}))})),o.on("close",(function(){t.Snowplough.sendStructuredEvent({category:"upsell-show-more-stats",action:"dismiss",label:s.name})}))}o.show(),this.isPro||t.Snowplough.sendStructuredEvent({category:"upsell-show-more-stats",action:"open",label:s.name})}})}),"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-right-stats","hermes-template-stats-pro-upsell-modal","fluid-modal-view","stats-photo-view","stats-helper","moment"],optionalRequires:["hermes-core"],optional:["photo-engagement-models"],langBundles:["common","photo-page-scrappy","stats","likes"]});YUI.add("hermes-template-sub-photo-contexts",(function(e,t){var l=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,l,a,n){var o=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,u=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return u((s(l,"outlet")||t&&s(t,"outlet")||r).call(o,null!=t?s(t,"sub-photo-groups-view"):t,{name:"outlet",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:32}}}))+"\n"+u((s(l,"outlet")||t&&s(t,"outlet")||r).call(o,null!=t?s(t,"sub-photo-albums-view"):t,{name:"outlet",hash:{},data:n,loc:{start:{line:2,column:0},end:{line:2,column:32}}}))+"\n"+u((s(l,"outlet")||t&&s(t,"outlet")||r).call(o,null!=t?s(t,"sub-photo-galleries-view"):t,{name:"outlet",hash:{},data:n,loc:{start:{line:3,column:0},end:{line:3,column:35}}}))+"\n"},useData:!0}),a={};e.Array.each([],(function(t){var l=e.Template.get("hermes/"+t);l&&(a[t]=l)})),e.Template.register("hermes/sub-photo-contexts",(function(t,n){return(n=n||{}).partials=n.partials?e.merge(a,n.partials):a,l(t,n)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-contexts-item",(function(n,l){var t=n.Template.Handlebars.revive({1:function(n,l,t,e,o){var a,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(a=r(t,"if").call(null!=l?l:n.nullContext||{},null!=(a=null!=l?r(l,"group"):l)?r(a,"mediumIconURL"):a,{name:"if",hash:{},fn:n.program(2,o,0),inverse:n.program(4,o,0),data:o,loc:{start:{line:3,column:2},end:{line:19,column:9}}}))?a:""},2:function(n,l,t,e,o){var a,r,u=n.escapeExpression,i=n.lambda,s=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<a href="'+u("function"==typeof(r=null!=(r=s(t,"url")||(null!=l?s(l,"url"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"url",hash:{},data:o,loc:{start:{line:4,column:12},end:{line:4,column:19}}}):r)+"\"\n\t\t\t\tclass='avatar group thumbnail'\n\t\t\t\tstyle='background-image: url(\""+u(i(null!=(a=null!=l?s(l,"group"):l)?s(a,"mediumIconURL"):a,l))+"\");'\n\t\t\t\tdata-group-nsid='"+u(i(null!=(a=null!=l?s(l,"group"):l)?s(a,"id"):a,l))+"'></a>\n"},4:function(n,l,t,e,o){var a,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(a=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"primaryPhotoSizes"):l,{name:"if",hash:{},fn:n.program(5,o,0),inverse:n.program(7,o,0),data:o,loc:{start:{line:9,column:3},end:{line:18,column:10}}}))?a:""},5:function(n,l,t,e,o){var a,r,u=n.escapeExpression,i=n.lambda,s=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t<a href="'+u("function"==typeof(r=null!=(r=s(t,"url")||(null!=l?s(l,"url"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"url",hash:{},data:o,loc:{start:{line:10,column:13},end:{line:10,column:20}}}):r)+"\"\n\t\t\t\t\tclass='avatar group thumbnail' style='background-image: url(\""+u(i(null!=(a=null!=(a=null!=l?s(l,"primaryPhotoSizes"):l)?s(a,"sq"):a)?s(a,"src"):a,l))+"\");'\n\t\t\t\t\tdata-group-nsid='"+u(i(null!=(a=null!=l?s(l,"group"):l)?s(a,"id"):a,l))+"'></a>\n"},7:function(n,l,t,e,o){var a,r,u=n.escapeExpression,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t<a href="'+u("function"==typeof(r=null!=(r=i(t,"url")||(null!=l?i(l,"url"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"url",hash:{},data:o,loc:{start:{line:14,column:13},end:{line:14,column:20}}}):r)+"\"\n\t\t\t\t\tclass='avatar group thumbnail'\n\t\t\t\t\tstyle='background-image: url(\"https://combo.staticflickr.com/pw/images/buddyicon11_s.png\");'\n\t\t\t\t\tdata-group-nsid='"+u(n.lambda(null!=(a=null!=l?i(l,"group"):l)?i(a,"id"):a,l))+"'></a>\n"},9:function(n,l,t,e,o){var a,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(a=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"bestIconURL"):l,{name:"if",hash:{},fn:n.program(10,o,0),inverse:n.program(12,o,0),data:o,loc:{start:{line:21,column:2},end:{line:29,column:9}}}))?a:""},10:function(n,l,t,e,o){var a,r=null!=l?l:n.nullContext||{},u=n.hooks.helperMissing,i="function",s=n.escapeExpression,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<a href="'+s(typeof(a=null!=(a=c(t,"url")||(null!=l?c(l,"url"):l))?a:u)===i?a.call(r,{name:"url",hash:{},data:o,loc:{start:{line:22,column:12},end:{line:22,column:19}}}):a)+"\" class='thumbnail' style='background-image: url(\""+s(typeof(a=null!=(a=c(t,"bestIconURL")||(null!=l?c(l,"bestIconURL"):l))?a:u)===i?a.call(r,{name:"bestIconURL",hash:{},data:o,loc:{start:{line:22,column:69},end:{line:22,column:84}}}):a)+"\");'></a>\n"},12:function(n,l,t,e,o){var a,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(a=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"primaryPhotoSizes"):l,{name:"if",hash:{},fn:n.program(13,o,0),inverse:n.program(15,o,0),data:o,loc:{start:{line:24,column:3},end:{line:28,column:10}}}))?a:""},13:function(n,l,t,e,o){var a,r,u=n.escapeExpression,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t<a href="'+u("function"==typeof(r=null!=(r=i(t,"url")||(null!=l?i(l,"url"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"url",hash:{},data:o,loc:{start:{line:25,column:13},end:{line:25,column:20}}}):r)+"\" class='thumbnail' style='background-image: url(\""+u(n.lambda(null!=(a=null!=(a=null!=l?i(l,"primaryPhotoSizes"):l)?i(a,"sq"):a)?i(a,"src"):a,l))+"\");'></a>\n"},15:function(n,l,t,e,o){var a,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t<a href="'+n.escapeExpression("function"==typeof(a=null!=(a=r(t,"url")||(null!=l?r(l,"url"):l))?a:n.hooks.helperMissing)?a.call(null!=l?l:n.nullContext||{},{name:"url",hash:{},data:o,loc:{start:{line:27,column:13},end:{line:27,column:20}}}):a)+"\" class='thumbnail' style='background-image: url(\"https://combo.staticflickr.com/pw/images/buddyicon11_s.png\");'></a>\n"},17:function(n,l,t,e,o){var a,r,u=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\n\t\t<span class='title'><a href=\""+s("function"==typeof(r=null!=(r=c(t,"url")||(null!=l?c(l,"url"):l))?r:i)?r.call(u,{name:"url",hash:{},data:o,loc:{start:{line:33,column:31},end:{line:33,column:38}}}):r)+'">'+(null!=(a=c(t,"if").call(u,null!=l?c(l,"truncateTitle"):l,{name:"if",hash:{},fn:n.program(18,o,0),inverse:n.noop,data:o,loc:{start:{line:33,column:40},end:{line:33,column:91}}}))?a:"")+s((c(t,"renderTrustedMarkup")||l&&c(l,"renderTrustedMarkup")||i).call(u,null!=l?c(l,"title"):l,{name:"renderTrustedMarkup",hash:{},data:o,loc:{start:{line:33,column:91},end:{line:33,column:120}}}))+(null!=(a=c(t,"if").call(u,null!=l?c(l,"truncateTitle"):l,{name:"if",hash:{},fn:n.program(20,o,0),inverse:n.noop,data:o,loc:{start:{line:33,column:120},end:{line:33,column:155}}}))?a:"")+"</a></span>\n\n"},18:function(n,l,t,e,o){return'<span class="truncate">'},20:function(n,l,t,e,o){return"</span>"},22:function(n,l,t,e,o){var a,r,u=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,s="function",c=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t<span class='title'><a href=\""+c(typeof(r=null!=(r=p(t,"url")||(null!=l?p(l,"url"):l))?r:i)===s?r.call(u,{name:"url",hash:{},data:o,loc:{start:{line:36,column:31},end:{line:36,column:38}}}):r)+'">'+(null!=(a=p(t,"if").call(u,null!=l?p(l,"truncateTitle"):l,{name:"if",hash:{},fn:n.program(18,o,0),inverse:n.noop,data:o,loc:{start:{line:36,column:40},end:{line:36,column:91}}}))?a:"")+c(typeof(r=null!=(r=p(t,"title")||(null!=l?p(l,"title"):l))?r:i)===s?r.call(u,{name:"title",hash:{},data:o,loc:{start:{line:36,column:91},end:{line:36,column:100}}}):r)+(null!=(a=p(t,"if").call(u,null!=l?p(l,"truncateTitle"):l,{name:"if",hash:{},fn:n.program(20,o,0),inverse:n.noop,data:o,loc:{start:{line:36,column:100},end:{line:36,column:135}}}))?a:"")+"</a></span>\n"},24:function(n,l,t,e,o){var a,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(a=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"isInvitation"):l,{name:"if",hash:{},fn:n.program(25,o,0),inverse:n.program(30,o,0),data:o,loc:{start:{line:40,column:3},end:{line:56,column:10}}}))?a:""},25:function(n,l,t,e,o){var a,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(a=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"invitedByViewer"):l,{name:"if",hash:{},fn:n.program(26,o,0),inverse:n.program(28,o,0),data:o,loc:{start:{line:41,column:4},end:{line:45,column:11}}}))?a:""},26:function(n,l,t,e,o){var a=null!=l?l:n.nullContext||{},r=n.hooks.helperMissing,u=n.escapeExpression,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t\t<a href="#" class="cancel-invite"><span class="pending-text">'+u((i(t,"intlMessage")||l&&i(l,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.INVITE_PENDING"},data:o,loc:{start:{line:42,column:66},end:{line:42,column:126}}}))+'</span><span class="cancel-text">'+u((i(t,"intlMessage")||l&&i(l,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.CANCEL_INVITE"},data:o,loc:{start:{line:42,column:159},end:{line:42,column:218}}}))+"</span></a>\n"},28:function(n,l,t,e,o){var a=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t\t<button href="#" class="ui-button ui-button-cta accept-invite">'+n.escapeExpression((a(t,"intlMessage")||l&&a(l,"intlMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ACCEPT_INVITE"},data:o,loc:{start:{line:44,column:68},end:{line:44,column:127}}}))+"</button>\n"},30:function(n,l,t,e,o){var a,r=null!=l?l:n.nullContext||{},u=n.hooks.helperMissing,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return(null!=(a=(i(t,"ifCond")||l&&i(l,"ifCond")||u).call(r,null!=l?i(l,"poolCount"):l,"===",0,{name:"ifCond",hash:{},fn:n.program(31,o,0),inverse:n.noop,data:o,loc:{start:{line:47,column:4},end:{line:49,column:15}}}))?a:"")+(null!=(a=(i(t,"ifCond")||l&&i(l,"ifCond")||u).call(r,null!=l?i(l,"poolCount"):l,"===",1,{name:"ifCond",hash:{},fn:n.program(33,o,0),inverse:n.noop,data:o,loc:{start:{line:50,column:4},end:{line:52,column:15}}}))?a:"")+(null!=(a=(i(t,"ifCond")||l&&i(l,"ifCond")||u).call(r,null!=l?i(l,"poolCount"):l,">",1,{name:"ifCond",hash:{},fn:n.program(35,o,0),inverse:n.noop,data:o,loc:{start:{line:53,column:4},end:{line:55,column:15}}}))?a:"")},31:function(n,l,t,e,o){return"\n"},33:function(n,l,t,e,o){var a=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t\t\t"+n.escapeExpression((a(t,"intlMessage")||l&&a(l,"intlMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ONE_ITEM"},data:o,loc:{start:{line:51,column:5},end:{line:51,column:59}}}))+"\n"},35:function(n,l,t,e,o){var a=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t\t\t"+n.escapeExpression((a(t,"intlMessage")||l&&a(l,"intlMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlMessage",hash:{count:null!=l?a(l,"friendlyPoolCount"):l,intlName:"photo-page-scrappy.N_ITEMS"},data:o,loc:{start:{line:54,column:5},end:{line:54,column:82}}}))+"\n"},37:function(n,l,t,e,o){var a,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t"+n.escapeExpression("function"==typeof(a=null!=(a=r(t,"photoCountDisplay")||(null!=l?r(l,"photoCountDisplay"):l))?a:n.hooks.helperMissing)?a.call(null!=l?l:n.nullContext||{},{name:"photoCountDisplay",hash:{},data:o,loc:{start:{line:58,column:3},end:{line:58,column:24}}}):a)+"\n"},39:function(n,l,t,e,o){return'\t\t<a href="#" class="remove"></a>\n'},compiler:[8,">= 4.3.0"],main:function(n,l,t,e,o){var a,r,u=null!=l?l:n.nullContext||{},i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<li data-context-id="'+n.escapeExpression("function"==typeof(r=null!=(r=i(t,"id")||(null!=l?i(l,"id"):l))?r:n.hooks.helperMissing)?r.call(u,{name:"id",hash:{},data:o,loc:{start:{line:1,column:21},end:{line:1,column:27}}}):r)+'">\n'+(null!=(a=i(t,"if").call(u,null!=l?i(l,"isGroup"):l,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.program(9,o,0),data:o,loc:{start:{line:2,column:1},end:{line:30,column:8}}}))?a:"")+(null!=(a=i(t,"if").call(u,null!=l?i(l,"isGroup"):l,{name:"if",hash:{},fn:n.program(17,o,0),inverse:n.program(22,o,0),data:o,loc:{start:{line:31,column:1},end:{line:37,column:8}}}))?a:"")+"\t<span class='counts'>\n"+(null!=(a=i(t,"if").call(u,null!=l?i(l,"isGroup"):l,{name:"if",hash:{},fn:n.program(24,o,0),inverse:n.program(37,o,0),data:o,loc:{start:{line:39,column:2},end:{line:59,column:9}}}))?a:"")+"\t</span>\n"+(null!=(a=i(t,"if").call(u,null!=l?i(l,"canRemove"):l,{name:"if",hash:{},fn:n.program(39,o,0),inverse:n.noop,data:o,loc:{start:{line:61,column:1},end:{line:63,column:8}}}))?a:"")+"</li>\n"},useData:!0}),e={};n.Array.each([],(function(l){var t=n.Template.get("hermes/"+l);t&&(e[l]=t)})),n.Template.register("hermes/sub-photo-contexts-item",(function(l,o){return(o=o||{}).partials=o.partials?n.merge(e,o.partials):e,t(l,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-contexts-title-groups",(function(n,e){var l=n.Template.Handlebars.revive({1:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},s=n.hooks.helperMissing,i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(a=(i(l,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"totalGroups"):e,"!==",0,{name:"ifCond",hash:{},fn:n.program(2,o,0),inverse:n.noop,data:o,loc:{start:{line:3,column:2},end:{line:5,column:13}}}))?a:"")+(null!=(a=(i(l,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"totalGroups"):e,"===",0,{name:"ifCond",hash:{},fn:n.program(4,o,0),inverse:n.noop,data:o,loc:{start:{line:6,column:2},end:{line:8,column:13}}}))?a:"")},2:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{count:null!=e?a(e,"totalGroups"):e,intlName:"photo-page-scrappy.GROUPS_COUNT"},data:o,loc:{start:{line:4,column:3},end:{line:4,column:79}}}))+"\n"},4:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_IN_NO_GROUPS"},data:o,loc:{start:{line:7,column:3},end:{line:7,column:67}}}))+"\n"},6:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},s=n.hooks.helperMissing,i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(a=(i(l,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"totalGroups"):e,"===",1,{name:"ifCond",hash:{},fn:n.program(7,o,0),inverse:n.noop,data:o,loc:{start:{line:10,column:2},end:{line:12,column:13}}}))?a:"")+(null!=(a=(i(l,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"totalGroups"):e,">",1,{name:"ifCond",hash:{},fn:n.program(9,o,0),inverse:n.noop,data:o,loc:{start:{line:13,column:2},end:{line:15,column:13}}}))?a:"")+(null!=(a=(i(l,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"totalGroups"):e,"===",0,{name:"ifCond",hash:{},fn:n.program(4,o,0),inverse:n.noop,data:o,loc:{start:{line:16,column:2},end:{line:18,column:13}}}))?a:"")},7:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_IN_ONE_GROUP"},data:o,loc:{start:{line:11,column:3},end:{line:11,column:67}}}))+"\n"},9:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{count:null!=e?a(e,"totalGroups"):e,intlName:"photo-page-scrappy.PHOTO_IN_MANY_GROUPS"},data:o,loc:{start:{line:14,column:3},end:{line:14,column:87}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(n,e,l,t,o){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<h5 class="total">\n'+(null!=(a=r(l,"if").call(null!=e?e:n.nullContext||{},null!=e?r(e,"isMobile"):e,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.program(6,o,0),data:o,loc:{start:{line:2,column:1},end:{line:19,column:8}}}))?a:"")+"</h5>"},useData:!0}),t={};n.Array.each([],(function(e){var l=n.Template.get("hermes/"+e);l&&(t[e]=l)})),n.Template.register("hermes/sub-photo-contexts-title-groups",(function(e,o){return(o=o||{}).partials=o.partials?n.merge(t,o.partials):t,l(e,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-contexts-groups",(function(n,t){var e=n.Template.Handlebars.revive({1:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"canAddOrInvite"):t,{name:"if",hash:{},fn:n.program(2,o,0),inverse:n.noop,data:o,loc:{start:{line:2,column:1},end:{line:12,column:8}}}))?a:""},2:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t<div class="sub-photo-context sub-photo-context-groups empty">\n\t\t\t<p tabindex="0">'+n.escapeExpression((s(e,"intlMessage")||t&&s(t,"intlMessage")||n.hooks.helperMissing).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_NOT_IN_GROUPS"},data:o,loc:{start:{line:4,column:19},end:{line:4,column:84}}}))+"</p>\n"+(null!=(a=s(e,"if").call(r,null!=t?s(t,"canAdd"):t,{name:"if",hash:{},fn:n.program(3,o,0),inverse:n.noop,data:o,loc:{start:{line:5,column:3},end:{line:7,column:10}}}))?a:"")+(null!=(a=s(e,"if").call(r,null!=t?s(t,"canInvite"):t,{name:"if",hash:{},fn:n.program(5,o,0),inverse:n.noop,data:o,loc:{start:{line:8,column:3},end:{line:10,column:10}}}))?a:"")+"\t\t</div>\n"},3:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t\t<p><a href='#' class='add-to'>"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_GROUP"},data:o,loc:{start:{line:6,column:34},end:{line:6,column:92}}}))+"</a></p>\n"},5:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t\t<p><a href='#' class='add-to'>"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.INVITE_TO_GROUP"},data:o,loc:{start:{line:9,column:34},end:{line:9,column:95}}}))+"</a></p>\n"},7:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(a=s(e,"if").call(r,null!=t?s(t,"viewerIsOwner"):t,{name:"if",hash:{},fn:n.program(8,o,0),inverse:n.noop,data:o,loc:{start:{line:14,column:1},end:{line:25,column:8}}}))?a:"")+'\t<div class="sub-photo-context sub-photo-context-groups">\n'+(null!=(a=n.invokePartial(s(l,"sub-photo-contexts-title-groups"),t,{name:"sub-photo-contexts-title-groups",data:o,indent:"\t\t",helpers:e,partials:l,decorators:n.decorators}))?a:"")+(null!=(a=s(e,"if").call(r,null!=t?s(t,"canAdd"):t,{name:"if",hash:{},fn:n.program(14,o,0),inverse:n.noop,data:o,loc:{start:{line:28,column:2},end:{line:30,column:9}}}))?a:"")+(null!=(a=s(e,"if").call(r,null!=t?s(t,"canInvite"):t,{name:"if",hash:{},fn:n.program(16,o,0),inverse:n.noop,data:o,loc:{start:{line:31,column:2},end:{line:33,column:9}}}))?a:"")+'\t\t<ul class="context-list">\n'+(null!=(a=s(e,"each").call(r,null!=t?s(t,"contexts"):t,{name:"each",hash:{},fn:n.program(18,o,0),inverse:n.noop,data:o,loc:{start:{line:35,column:3},end:{line:37,column:12}}}))?a:"")+"\t\t</ul>\n"+(null!=(a=s(e,"if").call(r,null!=t?s(t,"showMore"):t,{name:"if",hash:{},fn:n.program(20,o,0),inverse:n.noop,data:o,loc:{start:{line:39,column:2},end:{line:41,column:9}}}))?a:"")+"\t</div>\n"},8:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=(r(e,"ifCond")||t&&r(t,"ifCond")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=t?r(t,"totalInvitations"):t,">",0,{name:"ifCond",hash:{},fn:n.program(9,o,0),inverse:n.noop,data:o,loc:{start:{line:15,column:2},end:{line:24,column:13}}}))?a:""},9:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},s=n.hooks.helperMissing,i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<div class="invitation-notice" tabindex="0">\n'+(null!=(a=(i(e,"ifCond")||t&&i(t,"ifCond")||s).call(r,null!=t?i(t,"totalInvitations"):t,"===",1,{name:"ifCond",hash:{},fn:n.program(10,o,0),inverse:n.noop,data:o,loc:{start:{line:17,column:4},end:{line:19,column:15}}}))?a:"")+(null!=(a=(i(e,"ifCond")||t&&i(t,"ifCond")||s).call(r,null!=t?i(t,"totalInvitations"):t,">",1,{name:"ifCond",hash:{},fn:n.program(12,o,0),inverse:n.noop,data:o,loc:{start:{line:20,column:4},end:{line:22,column:15}}}))?a:"")+"\t\t\t</div>\n"},10:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t\t\t"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ONE_GROUP_INVITATION"},data:o,loc:{start:{line:18,column:5},end:{line:18,column:71}}}))+"\n"},12:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t\t\t"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{count:null!=t?a(t,"totalInvitationsFriendly"):t,intlName:"photo-page-scrappy.N_GROUP_INVITATIONS"},data:o,loc:{start:{line:21,column:5},end:{line:21,column:101}}}))+"\n"},14:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t<a href='#' class='add-to'>"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_GROUP"},data:o,loc:{start:{line:29,column:30},end:{line:29,column:88}}}))+"</a>\n"},16:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t<a href='#' class='add-to'>"+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.INVITE_TO_GROUP"},data:o,loc:{start:{line:32,column:30},end:{line:32,column:91}}}))+"</a>\n"},18:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=n.invokePartial(r(l,"sub-photo-contexts-item"),t,{name:"sub-photo-contexts-item",data:o,indent:"\t\t\t\t",helpers:e,partials:l,decorators:n.decorators}))?a:""},20:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<div class="view-all-contexts-of-type"><a href="#">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.VIEW_MORE_GROUPS"},data:o,loc:{start:{line:40,column:54},end:{line:40,column:116}}}))+"</a></div>\n"},compiler:[8,">= 4.3.0"],main:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"empty"):t,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.program(7,o,0),data:o,loc:{start:{line:1,column:0},end:{line:43,column:7}}}))?a:""},usePartial:!0,useData:!0}),l={};n.Array.each(["sub-photo-contexts-title-groups","sub-photo-contexts-item"],(function(t){var e=n.Template.get("hermes/"+t);e&&(l[t]=e)})),n.Template.register("hermes/sub-photo-contexts-groups",(function(t,o){return(o=o||{}).partials=o.partials?n.merge(l,o.partials):l,e(t,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-contexts-title-groups","hermes-template-sub-photo-contexts-item"]});